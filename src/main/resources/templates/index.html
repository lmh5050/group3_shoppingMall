<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ì‹ ì‚¬ ìˆ™ë…€ Home</title>
    <link rel="stylesheet" th:href="@{/css/Bars.css}">
    <link rel="stylesheet" th:href="@{/css/product-list.css}">
    <link rel="stylesheet" th:href="@{/css/footer.css}">
    <style>

    </style>
</head>
<body>
<!-- ë„¤ë¹„ê²Œì´ì…˜ ë°” í¬í•¨ -->
<div th:replace="Bars/nav_bar :: nav"></div>

<!-- ìƒí’ˆ ë¦¬ìŠ¤íŠ¸ ì„¹ì…˜ -->
<section class="product-section">
    <!-- ê²€ìƒ‰ ë° ì •ë ¬ -->
    <div class="search-sort-container">
        <input type="search" placeholder="Search Product Name" id="productName">
        <button type="button" onclick="searchProductFunction()">Search</button>

        <select id="sortOptions">
            <option th:each="option : ${sortList}" th:value="${option.getProductSortId}"
                    th:text="${option.getExplanation}">ì •ë ¬ ê¸°ì¤€</option>
        </select>
        <button type="button" onclick="orderProductFunction()">Check</button>
    </div>

    <!-- ìƒí’ˆ ë¦¬ìŠ¤íŠ¸ -->
    <div class="product-grid">
        <!-- ê²€ìƒ‰ ê²°ê³¼ ìžˆì„ ë•Œ -->
        <th:block th:if="${param.searchProduct != null}">
            <div class="product-card"
                 th:each="product : ${products}"
                 th:if="${product.getName().contains(param.searchProduct)
                 && !product.getStatus().equals('stop-display')}">
                <div class="product-img">
                    <img th:src="@{'/images/product/' + ${product.getProductId()} + '.png'}"
                         alt="Product Image"
                         th:classappend="${product.status == 'sold-out' ? 'grayscale' : ''}" />
                    <div class="sold-out-overlay" th:if="${product.status == 'sold-out'}">SOLD OUT</div>
                    <!-- ì¢‹ì•„ìš” ìˆ˜, í›„ê¸° ìˆ˜ -->
                    <div class="product-stats">
                        <span class="like-count"  th:text="|â¤ ${product.getLikeCount()}|"></span>
                        <span class="review-count" th:text="|ðŸ’­ ${product.getReviewCount()}|"></span>
                    </div>
                </div>
                <div class="product-info">
                    <h3 th:text="${product.getName()}">Fancy Product</h3>
                    <span class="price" th:text="|${product.price} ì›|">â‚©40,000</span>
                    <a class="detail-btn" th:href="@{'/productDetail?prdId=' + ${product.getProductId()}}">Show Detail</a>
                </div>
            </div>
        </th:block>

        <!-- ëª¨ë“  ìƒí’ˆ í‘œì‹œ -->
        <th:block th:if="${param.searchProduct == null}">
            <div class="product-card"
                 th:each="product : ${products}"
                 th:if="${!product.getStatus().equals('stop-display')}">
                <div class="product-img">
                    <img th:src="@{'/images/product/' + ${product.getProductId()} + '.png'}"
                         alt="Product Image"
                         th:classappend="${product.status == 'sold-out' ? 'grayscale' : ''}" />
                    <div class="sold-out-overlay" th:if="${product.status == 'sold-out'}">SOLD OUT</div>
                    <!-- ì¢‹ì•„ìš” ìˆ˜, í›„ê¸° ìˆ˜ -->
                    <div class="product-stats">
                        <span class="like-count" th:text="|â¤ ${product.getLikeCount()}|"></span>
                        <span class="review-count" th:text="|ðŸ’­ ${product.getReviewCount()}|"></span>
                    </div>
                </div>
                <div class="product-info">
                    <h3 th:text="${product.getName()}">Fancy Product</h3>
                    <span class="price" th:text="|${product.price} ì›|">â‚©40,000</span>
                    <a class="detail-btn" th:href="@{'/productDetail?prdId=' + ${product.getProductId()}}">Show Detail</a>
                </div>
            </div>
        </th:block>
    </div>
</section>

<!-- í‘¸í„° -->
<footer>
    <div th:replace="Bars/footer :: #footer"></div>
</footer>

<!-- ìŠ¤í¬ë¦½íŠ¸ -->
<script defer>
    function searchProductFunction() {
        let pdName = document.getElementById('productName').value;
        if (!pdName) {
            alert("ê²€ìƒ‰ì–´ë¥¼ ìž…ë ¥í•˜ì„¸ìš”.");
            return false;
        }
        let url = new URL(window.location.href);
        url.searchParams.set('searchProduct', pdName);
        window.location.href = url.toString();
    }

    function orderProductFunction(){
        const selectedValue = document.getElementById("sortOptions").value;
        let url = new URL(window.location.href);
        if (!selectedValue) {
            url.searchParams.delete('orderOption');
        } else {
            url.searchParams.set('orderOption', selectedValue);
        }
        window.location.href = url.toString();
    }
</script>

</body>
</html>
