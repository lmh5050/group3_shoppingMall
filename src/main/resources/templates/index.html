<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ì‹ ì‚¬ ìˆ™ë…€ Home</title>
    <link rel="stylesheet" th:href="@{/css/Bars.css}">
    <link rel="stylesheet" th:href="@{/css/product-list.css}">
    <link rel="stylesheet" th:href="@{/css/footer.css}">
    <style>
        .like-count .like-product {
            border: 0;
            background-color: transparent;
            color: red;
        }

        .like-count .not-like-product {
            border: 0;
            background-color: transparent;
            color: white;
        }
    </style>
</head>
<body>
<!-- ë„¤ë¹„ê²Œì´ì…˜ ë°” í¬í•¨ -->
<div th:replace="Bars/nav_bar :: nav"></div>

<!-- ìƒí’ˆ ë¦¬ìŠ¤íŠ¸ ì„¹ì…˜ -->
<section class="product-section">
    <!-- ê²€ìƒ‰ ë° ì •ë ¬ -->
    <div class="search-sort-container">
        <input type="search" placeholder="Search Product Name" id="productName">
        <button type="button" onclick="searchProductFunction()">Search</button>

        <select id="sortOptions">
            <option th:each="option : ${sortList}" th:value="${option.getProductSortId}"
                    th:text="${option.getExplanation}">ì •ë ¬ ê¸°ì¤€</option>
        </select>
        <button type="button" onclick="orderProductFunction()">Check</button>
    </div>

    <!-- ìƒí’ˆ ë¦¬ìŠ¤íŠ¸ -->
    <div class="product-grid">
        <!-- ê²€ìƒ‰ ê²°ê³¼ ìˆì„ ë•Œ -->
        <th:block th:if="${param.searchProduct != null}">
            <div class="product-card"
                 th:each="product : ${products}"
                 th:if="${product.getName().contains(param.searchProduct)
                 && !product.getStatus().equals('stop-display')}">
                <input type="hidden" th:value="${product.getProductId()}" class="product-id">
                <div class="product-img">
                    <img th:src="@{'/images/product/' + ${product.getProductId()} + '.png'}"
                         alt="Product Image"
                         th:classappend="${product.status == 'sold-out' ? 'grayscale' : ''}" />
                    <div class="sold-out-overlay" th:if="${product.status == 'sold-out'}">SOLD OUT</div>
                    <!-- ì¢‹ì•„ìš” ìˆ˜, í›„ê¸° ìˆ˜ -->
                    <div class="product-stats">
                        <span class="like-count">
                            <button th:text="|â¤ ${product.getLikeCount()}|" onclick="return likeProduct()"
                                    style="border: 0;
                                    background-color: transparent; color: white;"></button>
                        </span>
                        <span class="review-count">
                            <button th:text="|ğŸ’­ ${product.getReviewCount()}|" onclick="return getProductReviews()"
                                    style="border: 0;
                                    background-color: transparent; color: white;"></button>
                        </span>
                    </div>
                </div>
                <div class="product-info">
                    <h3 th:text="${product.getName()}">Fancy Product</h3>
                    <span class="price" th:text="|${product.price} ì›|">â‚©40,000</span>
                    <a class="detail-btn" th:href="@{'/productDetail?prdId=' + ${product.getProductId()}}">Show Detail</a>
                </div>
            </div>
        </th:block>

        <!-- ëª¨ë“  ìƒí’ˆ í‘œì‹œ -->
        <th:block th:if="${param.searchProduct == null}">
            <div class="product-card"
                 th:each="product : ${products}"
                 th:if="${!product.getStatus().equals('stop-display')}">
                <input type="hidden" th:value="${product.getProductId()}" id="product-id">
                <div class="product-img">
                    <img th:src="@{'/images/product/' + ${product.getProductId()} + '.png'}"
                         alt="Product Image"
                         th:classappend="${product.status == 'sold-out' ? 'grayscale' : ''}" />
                    <div class="sold-out-overlay" th:if="${product.status == 'sold-out'}">SOLD OUT</div>
                    <!-- ì¢‹ì•„ìš” ìˆ˜, í›„ê¸° ìˆ˜ -->
                    <div class="product-stats">
                        <th:block th:if="${session.get('customerId') != null}">
                            <span class="like-count">
                                <button th:text="|â¤ ${product.getLikeCount()}|"
                                        th:class="${userLike.contains(product.productId)} ? 'like-product' : 'not-like-product'"
                                        th:attr="data-product-id=${product.getProductId()}"
                                        onclick="return likeProduct(this.getAttribute('data-product-id'))"
                                ></button>
                            </span>
                        </th:block>
                        <span class="review-count">
                            <button th:text="|ğŸ’­ ${product.getReviewCount()}|" onclick="return getProductReviews()"
                                    style="border: 0;
                                    background-color: transparent; color: white;"></button>
                        </span>
                    </div>
                </div>
                <div class="product-info">
                    <h3 th:text="${product.getName()}">Fancy Product</h3>
                    <span class="price" th:text="|${product.price} ì›|">â‚©40,000</span>
                    <a class="detail-btn" th:href="@{'/productDetail?prdId=' + ${product.getProductId()}}">Show Detail</a>
                </div>
            </div>
        </th:block>
    </div>
</section>

<!-- í‘¸í„° -->
<footer>
    <div th:replace="Bars/footer :: #footer"></div>
</footer>

<!-- ìŠ¤í¬ë¦½íŠ¸ -->
<script defer>
    // ì¢‹ì•„ìš” ë²„íŠ¼
    function likeProduct(productId) {
        // ë¡œê·¸ì¸ì´ ë˜ì–´ìˆëŠ”ì§€ í™•ì¸(ì„¸ì…˜)
        if(window.sessionStorage.getItem('customerId') === null){
            // ë¡œê·¸ì¸ì´ ì•ˆë˜ì–´ ìˆì„ ê²½ìš°
            alert('ë¡œê·¸ì¸ í›„ ì´ìš©ê°€ëŠ¥í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.');
            window.location.href = "/user/login";
            return;
        }

        // ë¡œê·¸ì¸ì´ ë˜ì–´ìˆì„ ê²½ìš° - ì¢‹ì•„ìš”
        alert('ìƒí’ˆì„ ì¢‹ì•„ìš” ë¦¬ìŠ¤íŠ¸ì— ë‹´ì•˜ìŠµë‹ˆë‹¤.');
        // let productId = document.querySelector('#product-id').value;
        console.log(productId);
        let url = new URL(window.location.href);
        url.searchParams.set("likeProduct", productId);
        window.location.href = url.toString();
    }

    // ë¦¬ë·° ë³´ëŸ¬ ê°€ê¸°
    function getProductReviews() {
        alert("í›„ê¸° ë³´ê¸°");
    }

    // ê²€ìƒ‰ì–´ ë²„íŠ¼
    function searchProductFunction() {
        let pdName = document.getElementById('productName').value;
        if (!pdName) {
            alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
            return false;
        }
        let url = new URL(window.location.href);
        url.searchParams.set('searchProduct', pdName);
        window.location.href = url.toString();
    }

    function orderProductFunction(){
        const selectedValue = document.getElementById("sortOptions").value;
        let url = new URL(window.location.href);
        if (!selectedValue) {
            url.searchParams.delete('orderOption');
        } else {
            url.searchParams.set('orderOption', selectedValue);
        }
        window.location.href = url.toString();
    }
</script>

</body>
</html>
